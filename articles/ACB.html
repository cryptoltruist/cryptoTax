<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="cryptoTax">
<title>Adjusted Cost Base • cryptoTax</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Adjusted Cost Base">
<meta property="og:description" content="cryptoTax">
<meta property="og:image" content="https://cryptoltruist.github.io/cryptoTax/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-primary navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">cryptoTax</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/ACB.html">Adjusted Cost Base</a>
    <a class="dropdown-item" href="../articles/references.html">Tax treatments and decisions</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="http://github.com/cryptoltruist/cryptoTax/" aria-label="GitHub">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Adjusted Cost Base</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/cryptoltruist/cryptoTax/blob/HEAD/vignettes/ACB.Rmd" class="external-link"><code>vignettes/ACB.Rmd</code></a></small>
      <div class="d-none name"><code>ACB.Rmd</code></div>
    </div>

    
    
<p>In this vignette, we will demonstrate that calculations of the
adjusted cost base by <code>cryptoTax</code> closely follows those of <a href="https://www.adjustedcostbase.ca/" class="external-link uri">https://www.adjustedcostbase.ca/</a>.</p>
<div class="section level2">
<h2 id="basic-acb">Basic ACB<a class="anchor" aria-label="anchor" href="#basic-acb"></a>
</h2>
<p>To begin, we will replicate the basic ACB example showcased in <a href="https://www.adjustedcostbase.ca/blog/how-to-calculate-adjusted-cost-base-acb-and-capital-gains/" class="external-link uri">https://www.adjustedcostbase.ca/blog/how-to-calculate-adjusted-cost-base-acb-and-capital-gains/</a></p>
<p><img src="images/ACB0.png"></p>
<p>We first generate the data:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cryptoltruist.github.io/cryptoTax/">cryptoTax</a></span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data_adjustedcostbase1</span></span>
<span><span class="va">data</span></span>
<span><span class="co">#&gt;         date transaction quantity price fees</span></span>
<span><span class="co">#&gt; 1 2014-03-03         buy      100    50   10</span></span>
<span><span class="co">#&gt; 2 2014-05-01        sell       50   120   10</span></span>
<span><span class="co">#&gt; 3 2014-07-18         buy       50   130   10</span></span>
<span><span class="co">#&gt; 4 2014-09-25        sell       40    90   10</span></span></code></pre></div>
<p>Next, we generate the calculations to achieve the following
result:</p>
<p><img src="images/ACB1.png"></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ACB.html">ACB</a></span><span class="op">(</span><span class="va">data</span>, spot.rate <span class="op">=</span> <span class="st">"price"</span>, sup.loss <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt;         date transaction quantity price fees total.price total.quantity  ACB</span></span>
<span><span class="co">#&gt; 1 2014-03-03         buy      100    50   10        5000            100 5010</span></span>
<span><span class="co">#&gt; 2 2014-05-01        sell       50   120   10        6000             50 2505</span></span>
<span><span class="co">#&gt; 3 2014-07-18         buy       50   130   10        6500            100 9015</span></span>
<span><span class="co">#&gt; 4 2014-09-25        sell       40    90   10        3600             60 5409</span></span>
<span><span class="co">#&gt;   ACB.share gains</span></span>
<span><span class="co">#&gt; 1     50.10    NA</span></span>
<span><span class="co">#&gt; 2     50.10  3485</span></span>
<span><span class="co">#&gt; 3     90.15    NA</span></span>
<span><span class="co">#&gt; 4     90.15   -16</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="superficial-losses">Superficial losses<a class="anchor" aria-label="anchor" href="#superficial-losses"></a>
</h2>
<p>We will now replicate the more advanced superficial loss example
showcased at <a href="https://www.adjustedcostbase.ca/blog/what-is-the-superficial-loss-rule/" class="external-link uri">https://www.adjustedcostbase.ca/blog/what-is-the-superficial-loss-rule/</a>.</p>
<div class="section level3">
<h3 id="example-1">Example 1<a class="anchor" aria-label="anchor" href="#example-1"></a>
</h3>
<p>We first demonstrate the “Violation of the Superficial Loss Rule” by
using regular ACB <em>without</em> accounting for superficial
losses:</p>
<p><img src="images/ACB2.png"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data_adjustedcostbase2</span></span>
<span><span class="fu"><a href="../reference/ACB.html">ACB</a></span><span class="op">(</span><span class="va">data</span>, spot.rate <span class="op">=</span> <span class="st">"price"</span>, sup.loss <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt;         date transaction quantity price total.price fees total.quantity  ACB</span></span>
<span><span class="co">#&gt; 1 2014-01-06         buy      100    50        5000    0            100 5000</span></span>
<span><span class="co">#&gt; 2 2014-11-03        sell      100    30        3000    0              0    0</span></span>
<span><span class="co">#&gt; 3 2014-11-04         buy      100    30        3000    0            100 3000</span></span>
<span><span class="co">#&gt; 4 2015-12-02        sell      100    80        8000    0              0    0</span></span>
<span><span class="co">#&gt;   ACB.share gains</span></span>
<span><span class="co">#&gt; 1        50    NA</span></span>
<span><span class="co">#&gt; 2         0 -2000</span></span>
<span><span class="co">#&gt; 3        30    NA</span></span>
<span><span class="co">#&gt; 4         0  5000</span></span></code></pre></div>
<p>Next, we do it the correct way, <em>accounting</em> for superficial
losses:</p>
<p><img src="images/ACB3.png"></p>
<p>Per default, setting <code>sup.loss = TRUE</code> (the default)
generates a lot of columns to provide as much information as possible.
To make it look as short as the adjustedcostbase.ca example, we can
subselect relevant columns:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ACB.html">ACB</a></span><span class="op">(</span><span class="va">data</span>, spot.rate <span class="op">=</span> <span class="st">"price"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">transaction</span>, <span class="va">quantity</span>, <span class="va">price</span>, <span class="va">total.quantity</span>, <span class="va">ACB</span>, <span class="va">ACB.share</span>, <span class="va">gains</span><span class="op">)</span></span>
<span><span class="co">#&gt;         date transaction quantity price total.quantity  ACB ACB.share gains</span></span>
<span><span class="co">#&gt; 1 2014-01-06         buy      100    50            100 5000        50    NA</span></span>
<span><span class="co">#&gt; 2 2014-11-03        sell      100    30              0    0         0    NA</span></span>
<span><span class="co">#&gt; 3 2014-11-04         buy      100    30            100 5000        50    NA</span></span>
<span><span class="co">#&gt; 4 2015-12-02        sell      100    80              0    0         0  3000</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-2">Example 2<a class="anchor" aria-label="anchor" href="#example-2"></a>
</h3>
<p>We continue with the second superficial loss example. We first
demonstrate the “Violation of the Superficial Loss Rule” by using
regular ACB <em>without</em> accounting for superficial losses:</p>
<p><img src="images/ACB4.png"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data_adjustedcostbase3</span></span>
<span><span class="fu"><a href="../reference/ACB.html">ACB</a></span><span class="op">(</span><span class="va">data</span>, spot.rate <span class="op">=</span> <span class="st">"price"</span>, sup.loss <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt;         date transaction quantity price total.price fees total.quantity  ACB</span></span>
<span><span class="co">#&gt; 1 2014-01-06         buy      100    50        5000    0            100 5000</span></span>
<span><span class="co">#&gt; 2 2014-11-03         buy      100    30        3000    0            200 8000</span></span>
<span><span class="co">#&gt; 3 2014-11-04        sell      100    30        3000    0            100 4000</span></span>
<span><span class="co">#&gt; 4 2015-12-02        sell      100    80        8000    0              0    0</span></span>
<span><span class="co">#&gt;   ACB.share gains</span></span>
<span><span class="co">#&gt; 1        50    NA</span></span>
<span><span class="co">#&gt; 2        40    NA</span></span>
<span><span class="co">#&gt; 3        40 -1000</span></span>
<span><span class="co">#&gt; 4         0  4000</span></span></code></pre></div>
<p>Next, we do it the correct way, <em>accounting</em> for superficial
losses:</p>
<p><img src="images/ACB5.png"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ACB.html">ACB</a></span><span class="op">(</span><span class="va">data</span>, spot.rate <span class="op">=</span> <span class="st">"price"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">transaction</span>, <span class="va">quantity</span>, <span class="va">price</span>, <span class="va">total.quantity</span>, <span class="va">ACB</span>, <span class="va">ACB.share</span>, <span class="va">gains</span><span class="op">)</span></span>
<span><span class="co">#&gt;         date transaction quantity price total.quantity  ACB ACB.share gains</span></span>
<span><span class="co">#&gt; 1 2014-01-06         buy      100    50            100 5000        50    NA</span></span>
<span><span class="co">#&gt; 2 2014-11-03         buy      100    30            200 8000        40    NA</span></span>
<span><span class="co">#&gt; 3 2014-11-04        sell      100    30            100 5000        50    NA</span></span>
<span><span class="co">#&gt; 4 2015-12-02        sell      100    80              0    0         0  3000</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-3">Example 3<a class="anchor" aria-label="anchor" href="#example-3"></a>
</h3>
<p>We continue with the third superficial loss example (first example in
<a href="https://www.adjustedcostbase.ca/blog/applying-the-superficial-loss-rule-for-a-partial-disposition-of-shares/" class="external-link uri">https://www.adjustedcostbase.ca/blog/applying-the-superficial-loss-rule-for-a-partial-disposition-of-shares/</a>).
We first demonstrate the “Violation of the Superficial Loss Rule” by
using regular ACB <em>without</em> accounting for superficial
losses:</p>
<div class="section level4">
<h4 id="when-shares-are-sold-at-a-loss-and-then-partially-reacquired-within-the-superficial-loss-period">When Shares are Sold at a Loss and then Partially Reacquired within
the Superficial Loss Period<a class="anchor" aria-label="anchor" href="#when-shares-are-sold-at-a-loss-and-then-partially-reacquired-within-the-superficial-loss-period"></a>
</h4>
<p><img src="images/ACB6.png"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data_adjustedcostbase4</span></span>
<span><span class="fu"><a href="../reference/ACB.html">ACB</a></span><span class="op">(</span><span class="va">data</span>, spot.rate <span class="op">=</span> <span class="st">"price"</span>, sup.loss <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt;         date transaction quantity price total.price fees total.quantity ACB</span></span>
<span><span class="co">#&gt; 1 2015-01-02         buy      100   3.0         300    0            100 300</span></span>
<span><span class="co">#&gt; 2 2015-04-09        sell      100   2.0         200    0              0   0</span></span>
<span><span class="co">#&gt; 3 2015-04-10         buy       25   2.2          55    0             25  55</span></span>
<span><span class="co">#&gt;   ACB.share gains</span></span>
<span><span class="co">#&gt; 1       3.0    NA</span></span>
<span><span class="co">#&gt; 2       0.0  -100</span></span>
<span><span class="co">#&gt; 3       2.2    NA</span></span></code></pre></div>
<p>Next, we do it the correct way, <em>accounting</em> for superficial
losses:</p>
<p><img src="images/ACB7.png"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ACB.html">ACB</a></span><span class="op">(</span><span class="va">data</span>, spot.rate <span class="op">=</span> <span class="st">"price"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">transaction</span>, <span class="va">quantity</span>, <span class="va">price</span>, <span class="va">total.quantity</span>, <span class="va">ACB</span>, <span class="va">ACB.share</span>, <span class="va">gains</span><span class="op">)</span></span>
<span><span class="co">#&gt;         date transaction quantity price total.quantity ACB ACB.share gains</span></span>
<span><span class="co">#&gt; 1 2015-01-02         buy      100   3.0            100 300       3.0    NA</span></span>
<span><span class="co">#&gt; 2 2015-04-09        sell      100   2.0              0   0       0.0   -75</span></span>
<span><span class="co">#&gt; 3 2015-04-10         buy       25   2.2             25  80       3.2    NA</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="example-4">Example 4<a class="anchor" aria-label="anchor" href="#example-4"></a>
</h3>
<p>We continue with the fourth superficial loss example (second example
in <a href="https://www.adjustedcostbase.ca/blog/applying-the-superficial-loss-rule-for-a-partial-disposition-of-shares/" class="external-link uri">https://www.adjustedcostbase.ca/blog/applying-the-superficial-loss-rule-for-a-partial-disposition-of-shares/</a>).
We first demonstrate the “Violation of the Superficial Loss Rule” by
using regular ACB <em>without</em> accounting for superficial
losses:</p>
<div class="section level4">
<h4 id="when-shares-are-purchased-and-then-partially-sold-within-the-superficial-loss-period">When Shares are Purchased and then Partially Sold within the
Superficial Loss Period<a class="anchor" aria-label="anchor" href="#when-shares-are-purchased-and-then-partially-sold-within-the-superficial-loss-period"></a>
</h4>
<p><img src="images/ACB8.png"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data_adjustedcostbase5</span></span>
<span><span class="fu"><a href="../reference/ACB.html">ACB</a></span><span class="op">(</span><span class="va">data</span>, spot.rate <span class="op">=</span> <span class="st">"price"</span>, sup.loss <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt;         date transaction quantity price total.price fees total.quantity ACB</span></span>
<span><span class="co">#&gt; 1 2015-04-09         buy      100     3         300    0            100 300</span></span>
<span><span class="co">#&gt; 2 2015-04-10        sell       80     2         160    0             20  60</span></span>
<span><span class="co">#&gt;   ACB.share gains</span></span>
<span><span class="co">#&gt; 1         3    NA</span></span>
<span><span class="co">#&gt; 2         3   -80</span></span></code></pre></div>
<p>Next, we do it the correct way, <em>accounting</em> for superficial
losses:</p>
<p><img src="images/ACB9.png"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ACB.html">ACB</a></span><span class="op">(</span><span class="va">data</span>, spot.rate <span class="op">=</span> <span class="st">"price"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">transaction</span>, <span class="va">quantity</span>, <span class="va">price</span>, <span class="va">total.quantity</span>, <span class="va">ACB</span>, <span class="va">ACB.share</span>, <span class="va">gains</span><span class="op">)</span></span>
<span><span class="co">#&gt;         date transaction quantity price total.quantity ACB ACB.share gains</span></span>
<span><span class="co">#&gt; 1 2015-04-09         buy      100     3            100 300         3    NA</span></span>
<span><span class="co">#&gt; 2 2015-04-10        sell       80     2             20  80         4    NA</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="example-5">Example 5<a class="anchor" aria-label="anchor" href="#example-5"></a>
</h3>
<div class="section level4">
<h4 id="when-multiple-acquisitions-andor-multiple-dispositions-occur-within-the-superficial-loss-period">When Multiple Acquisitions and/or Multiple Dispositions Occur Within
the Superficial Loss Period<a class="anchor" aria-label="anchor" href="#when-multiple-acquisitions-andor-multiple-dispositions-occur-within-the-superficial-loss-period"></a>
</h4>
<p>There are no examples given for this one, so we make our own.
adjustedcostbase.ca writes that the web-based application does not
support claiming partial losses automatically:</p>
<blockquote>
<p>Note that AdjustedCostBase.ca does not automatically apply the
superficial loss rule for you. Although you’ll see superficial loss rule
warnings being displayed in many cases, it’s up to you to edit the
transaction to apply the superficial loss rule. Also, in cases where
you’re partially claiming a loss due to the superficial loss rule,
you’ll need to manually calculate the partial capital loss using the
methods described above.</p>
</blockquote>
<p>Fortunately, <code>cryptoTax</code> allows claiming partial losses
automatically. We first demonstrate the “Violation of the Superficial
Loss Rule” by using regular ACB <em>without</em> accounting for
superficial losses:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data_adjustedcostbase6</span></span>
<span><span class="fu"><a href="../reference/ACB.html">ACB</a></span><span class="op">(</span><span class="va">data</span>, spot.rate <span class="op">=</span> <span class="st">"price"</span>, sup.loss <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt;         date transaction quantity price total.price fees total.quantity ACB</span></span>
<span><span class="co">#&gt; 1 2015-04-09         buy      150     3         450    0            150 450</span></span>
<span><span class="co">#&gt; 2 2015-04-10        sell       20     2          40    0            130 390</span></span>
<span><span class="co">#&gt; 3 2015-04-15         buy       50     3         150    0            180 540</span></span>
<span><span class="co">#&gt; 4 2015-04-20        sell       10     2          20    0            170 510</span></span>
<span><span class="co">#&gt; 5 2015-05-15        sell       80     2         160    0             90 270</span></span>
<span><span class="co">#&gt;   ACB.share gains</span></span>
<span><span class="co">#&gt; 1         3    NA</span></span>
<span><span class="co">#&gt; 2         3   -20</span></span>
<span><span class="co">#&gt; 3         3    NA</span></span>
<span><span class="co">#&gt; 4         3   -10</span></span>
<span><span class="co">#&gt; 5         3   -80</span></span></code></pre></div>
<p>Next, we do it the correct way, <em>accounting</em> for superficial
losses, and include a few more columns for the demonstration:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ACB.html">ACB</a></span><span class="op">(</span><span class="va">data</span>, spot.rate <span class="op">=</span> <span class="st">"price"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="va">date</span>, <span class="va">transaction</span>, <span class="va">quantity</span>, <span class="va">price</span>, <span class="va">total.quantity</span>,</span>
<span>    <span class="va">suploss.range</span>, <span class="va">sup.loss</span>, <span class="va">sup.loss.quantity</span>, <span class="va">ACB</span>, <span class="va">ACB.share</span>,</span>
<span>    <span class="va">gains.uncorrected</span>, <span class="va">gains.sup</span>, <span class="va">gains.excess</span>, <span class="va">gains</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt;         date transaction quantity price total.quantity</span></span>
<span><span class="co">#&gt; 1 2015-04-09         buy      150     3            150</span></span>
<span><span class="co">#&gt; 2 2015-04-10        sell       20     2            130</span></span>
<span><span class="co">#&gt; 3 2015-04-15         buy       50     3            180</span></span>
<span><span class="co">#&gt; 4 2015-04-20        sell       10     2            170</span></span>
<span><span class="co">#&gt; 5 2015-05-15        sell       80     2             90</span></span>
<span><span class="co">#&gt;                    suploss.range sup.loss sup.loss.quantity      ACB ACB.share</span></span>
<span><span class="co">#&gt; 1 2015-03-10 UTC--2015-05-09 UTC    FALSE                 0 450.0000  3.000000</span></span>
<span><span class="co">#&gt; 2 2015-03-11 UTC--2015-05-10 UTC     TRUE                20 410.0000  3.153846</span></span>
<span><span class="co">#&gt; 3 2015-03-16 UTC--2015-05-15 UTC    FALSE                 0 580.0000  3.222222</span></span>
<span><span class="co">#&gt; 4 2015-03-21 UTC--2015-05-20 UTC     TRUE                10 560.0000  3.294118</span></span>
<span><span class="co">#&gt; 5 2015-04-15 UTC--2015-06-14 UTC     TRUE                80 361.1765  4.013072</span></span>
<span><span class="co">#&gt;   gains.uncorrected gains.sup gains.excess     gains</span></span>
<span><span class="co">#&gt; 1           0.00000        NA           NA        NA</span></span>
<span><span class="co">#&gt; 2         -20.00000 -20.00000           NA        NA</span></span>
<span><span class="co">#&gt; 3           0.00000        NA           NA        NA</span></span>
<span><span class="co">#&gt; 4         -12.22222 -12.22222           NA        NA</span></span>
<span><span class="co">#&gt; 5        -103.52941 -64.70588    -38.82353 -38.82353</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="other-examples-from-the-internet">Other examples from the internet<a class="anchor" aria-label="anchor" href="#other-examples-from-the-internet"></a>
</h2>
<div class="section level3">
<h3 id="cryptotaxcalculator">CryptoTaxCalculator<a class="anchor" aria-label="anchor" href="#cryptotaxcalculator"></a>
</h3>
<div class="section level4">
<h4 id="example-1-1">Example 1<a class="anchor" aria-label="anchor" href="#example-1-1"></a>
</h4>
<p>Here is an example from CryptoTaxCalculator, showcased at: <a href="https://cryptotaxcalculator.io/guides/crypto-tax-canada-cra/" class="external-link uri">https://cryptotaxcalculator.io/guides/crypto-tax-canada-cra/</a>.
We first demonstrate the “Violation of the Superficial Loss Rule” by
using regular ACB <em>without</em> accounting for superficial
losses:</p>
<p><img src="images/cryptotaxcalculator1.png"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data_cryptotaxcalculator1</span></span>
<span><span class="fu"><a href="../reference/ACB.html">ACB</a></span><span class="op">(</span><span class="va">data</span>, transaction <span class="op">=</span> <span class="st">"trade"</span>, spot.rate <span class="op">=</span> <span class="st">"price"</span>, sup.loss <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt;         date trade currency price quantity total.price fees total.quantity</span></span>
<span><span class="co">#&gt; 1 2020-01-01   buy      BTC  5000        2       10000    0              2</span></span>
<span><span class="co">#&gt; 2 2020-02-03  sell      BTC  3000        2        6000    0              0</span></span>
<span><span class="co">#&gt; 3 2020-02-04   buy      BTC  3000        2        6000    0              2</span></span>
<span><span class="co">#&gt; 4 2021-02-04  sell      BTC 10000        2       20000    0              0</span></span>
<span><span class="co">#&gt;     ACB ACB.share gains</span></span>
<span><span class="co">#&gt; 1 10000      5000    NA</span></span>
<span><span class="co">#&gt; 2     0         0 -4000</span></span>
<span><span class="co">#&gt; 3  6000      3000    NA</span></span>
<span><span class="co">#&gt; 4     0         0 14000</span></span></code></pre></div>
<p>Next, we do it the correct way, <em>accounting</em> for superficial
losses:</p>
<p><img src="images/cryptotaxcalculator2.png"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ACB.html">ACB</a></span><span class="op">(</span><span class="va">data</span>, transaction <span class="op">=</span> <span class="st">"trade"</span>, spot.rate <span class="op">=</span> <span class="st">"price"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">trade</span>, <span class="va">price</span>, <span class="va">quantity</span>, <span class="va">total.quantity</span>, <span class="va">ACB</span>, <span class="va">ACB.share</span>, <span class="va">gains</span><span class="op">)</span></span>
<span><span class="co">#&gt;         date trade price quantity total.quantity   ACB ACB.share gains</span></span>
<span><span class="co">#&gt; 1 2020-01-01   buy  5000        2              2 10000      5000    NA</span></span>
<span><span class="co">#&gt; 2 2020-02-03  sell  3000        2              0     0         0    NA</span></span>
<span><span class="co">#&gt; 3 2020-02-04   buy  3000        2              2 10000      5000    NA</span></span>
<span><span class="co">#&gt; 4 2021-02-04  sell 10000        2              0     0         0 10000</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="example-2-1">Example 2<a class="anchor" aria-label="anchor" href="#example-2-1"></a>
</h4>
<p>We continue with the second superficial loss example. We first
demonstrate the “Violation of the Superficial Loss Rule” by using
regular ACB <em>without</em> accounting for superficial losses:</p>
<p><img src="images/cryptotaxcalculator3.png"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data_cryptotaxcalculator2</span></span>
<span><span class="fu"><a href="../reference/ACB.html">ACB</a></span><span class="op">(</span><span class="va">data</span>, transaction <span class="op">=</span> <span class="st">"trade"</span>, spot.rate <span class="op">=</span> <span class="st">"price"</span>, sup.loss <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt;         date trade currency price quantity total.price fees total.quantity</span></span>
<span><span class="co">#&gt; 1 2020-01-01   buy      BTC  5000        2       10000    0              2</span></span>
<span><span class="co">#&gt; 2 2020-02-05   buy      BTC  1000        2        2000    0              4</span></span>
<span><span class="co">#&gt; 3 2020-02-06  sell      BTC  1000        2        2000    0              2</span></span>
<span><span class="co">#&gt; 4 2021-02-06  sell      BTC 10000        2       20000    0              0</span></span>
<span><span class="co">#&gt;     ACB ACB.share gains</span></span>
<span><span class="co">#&gt; 1 10000      5000    NA</span></span>
<span><span class="co">#&gt; 2 12000      3000    NA</span></span>
<span><span class="co">#&gt; 3  6000      3000 -4000</span></span>
<span><span class="co">#&gt; 4     0         0 14000</span></span></code></pre></div>
<p>Next, we do it the correct way, <em>accounting</em> for superficial
losses:</p>
<p><img src="images/cryptotaxcalculator4.png"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ACB.html">ACB</a></span><span class="op">(</span><span class="va">data</span>, transaction <span class="op">=</span> <span class="st">"trade"</span>, spot.rate <span class="op">=</span> <span class="st">"price"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">trade</span>, <span class="va">price</span>, <span class="va">quantity</span>, <span class="va">total.quantity</span>, <span class="va">ACB</span>, <span class="va">ACB.share</span>, <span class="va">gains</span><span class="op">)</span></span>
<span><span class="co">#&gt;         date trade price quantity total.quantity   ACB ACB.share gains</span></span>
<span><span class="co">#&gt; 1 2020-01-01   buy  5000        2              2 10000      5000    NA</span></span>
<span><span class="co">#&gt; 2 2020-02-05   buy  1000        2              4 12000      3000    NA</span></span>
<span><span class="co">#&gt; 3 2020-02-06  sell  1000        2              2 10000      5000    NA</span></span>
<span><span class="co">#&gt; 4 2021-02-06  sell 10000        2              0     0         0 10000</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="coinpanda">Coinpanda<a class="anchor" aria-label="anchor" href="#coinpanda"></a>
</h3>
<div class="section level4">
<h4 id="example-1-2">Example 1<a class="anchor" aria-label="anchor" href="#example-1-2"></a>
</h4>
<p>Here is an example from Coinpanda, showcased at: <a href="https://coinpanda.io/blog/crypto-taxes-canada-adjusted-cost-base/" class="external-link uri">https://coinpanda.io/blog/crypto-taxes-canada-adjusted-cost-base/</a>.
The first example does not require the superficial loss rule so we can
set it to <code>FALSE</code> without worry.</p>
<p><img src="images/coinpanda1.png"><img src="images/coinpanda2.png"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data_coinpanda1</span></span>
<span><span class="fu"><a href="../reference/ACB.html">ACB</a></span><span class="op">(</span><span class="va">data</span>,</span>
<span>  transaction <span class="op">=</span> <span class="st">"type"</span>, quantity <span class="op">=</span> <span class="st">"amount"</span>,</span>
<span>  total.price <span class="op">=</span> <span class="st">"price"</span>, sup.loss <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   type       date currency amount price fees total.quantity  ACB ACB.share</span></span>
<span><span class="co">#&gt; 1  buy 2019-08-14      BTC    0.2  1800   20            0.2 1820  9100.000</span></span>
<span><span class="co">#&gt; 2  buy 2019-10-29      BTC    0.6  4300   20            0.8 6140  7675.000</span></span>
<span><span class="co">#&gt; 3 sell 2020-06-05      BTC    0.8  5700    0            0.0    0     0.000</span></span>
<span><span class="co">#&gt; 4  buy 2020-09-23      BTC    1.2  8200    0            1.2 8200  6833.333</span></span>
<span><span class="co">#&gt;   gains</span></span>
<span><span class="co">#&gt; 1    NA</span></span>
<span><span class="co">#&gt; 2    NA</span></span>
<span><span class="co">#&gt; 3  -440</span></span>
<span><span class="co">#&gt; 4    NA</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="example-2-2">Example 2<a class="anchor" aria-label="anchor" href="#example-2-2"></a>
</h4>
<p>We continue with the second superficial loss example. We first
demonstrate the “Violation of the Superficial Loss Rule” by using
regular ACB <em>without</em> accounting for superficial losses:</p>
<p><img src="images/coinpanda3.png"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data_coinpanda2</span></span>
<span><span class="fu"><a href="../reference/ACB.html">ACB</a></span><span class="op">(</span><span class="va">data</span>,</span>
<span>  transaction <span class="op">=</span> <span class="st">"type"</span>, quantity <span class="op">=</span> <span class="st">"amount"</span>,</span>
<span>  total.price <span class="op">=</span> <span class="st">"price"</span>, sup.loss <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   type       date currency amount price fees total.quantity  ACB ACB.share</span></span>
<span><span class="co">#&gt; 1  buy 2019-08-14      BTC    0.2  1800   20            0.2 1820  9100.000</span></span>
<span><span class="co">#&gt; 2  buy 2019-10-29      BTC    0.6  4300   20            0.8 6140  7675.000</span></span>
<span><span class="co">#&gt; 3 sell 2020-06-05      BTC    0.8  5700    0            0.0    0     0.000</span></span>
<span><span class="co">#&gt; 4  buy 2020-06-07      BTC    1.2  7000    0            1.2 7000  5833.333</span></span>
<span><span class="co">#&gt;   gains</span></span>
<span><span class="co">#&gt; 1    NA</span></span>
<span><span class="co">#&gt; 2    NA</span></span>
<span><span class="co">#&gt; 3  -440</span></span>
<span><span class="co">#&gt; 4    NA</span></span></code></pre></div>
<p>Next, we do it the correct way, <em>accounting</em> for superficial
losses:</p>
<p><img src="images/coinpanda4.png"></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ACB.html">ACB</a></span><span class="op">(</span><span class="va">data</span>, transaction <span class="op">=</span> <span class="st">"type"</span>, quantity <span class="op">=</span> <span class="st">"amount"</span>, total.price <span class="op">=</span> <span class="st">"price"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">type</span>, <span class="va">date</span>, <span class="va">amount</span>, <span class="va">price</span>, <span class="va">fees</span>, <span class="va">ACB</span>, <span class="va">ACB.share</span>, <span class="va">gains</span><span class="op">)</span></span>
<span><span class="co">#&gt;   type       date amount price fees  ACB ACB.share gains</span></span>
<span><span class="co">#&gt; 1  buy 2019-08-14    0.2  1800   20 1820      9100    NA</span></span>
<span><span class="co">#&gt; 2  buy 2019-10-29    0.6  4300   20 6140      7675    NA</span></span>
<span><span class="co">#&gt; 3 sell 2020-06-05    0.8  5700    0    0         0    NA</span></span>
<span><span class="co">#&gt; 4  buy 2020-06-07    1.2  7000    0 7440      6200    NA</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="koinly">Koinly<a class="anchor" aria-label="anchor" href="#koinly"></a>
</h3>
<p>Here is an example from Koinly, showcased at: <a href="https://koinly.io/blog/calculating-crypto-taxes-canada/" class="external-link uri">https://koinly.io/blog/calculating-crypto-taxes-canada/</a>.
We first demonstrate the “Violation of the Superficial Loss Rule” by
using regular ACB <em>without</em> accounting for superficial
losses:</p>
<p><img src="images/koinly1.png"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data_koinly</span></span>
<span><span class="fu"><a href="../reference/ACB.html">ACB</a></span><span class="op">(</span><span class="va">data</span>, sup.loss <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt;         date transaction currency quantity spot.rate total.price fees</span></span>
<span><span class="co">#&gt; 1 2019-01-06         buy      ETH      100        50        5000    0</span></span>
<span><span class="co">#&gt; 2 2019-11-03        sell      ETH      100        30        3000    0</span></span>
<span><span class="co">#&gt; 3 2019-11-04         buy      ETH      100        30        3000    0</span></span>
<span><span class="co">#&gt;   total.quantity  ACB ACB.share gains</span></span>
<span><span class="co">#&gt; 1            100 5000        50    NA</span></span>
<span><span class="co">#&gt; 2              0    0         0 -2000</span></span>
<span><span class="co">#&gt; 3            100 3000        30    NA</span></span></code></pre></div>
<p>Next, we do it the correct way, <em>accounting</em> for superficial
losses:</p>
<p><img src="images/koinly2.png"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ACB.html">ACB</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">transaction</span>, <span class="va">quantity</span>, <span class="va">spot.rate</span>, <span class="va">total.quantity</span>, <span class="va">ACB</span>, <span class="va">ACB.share</span>, <span class="va">gains</span><span class="op">)</span></span>
<span><span class="co">#&gt;         date transaction quantity spot.rate total.quantity  ACB ACB.share gains</span></span>
<span><span class="co">#&gt; 1 2019-01-06         buy      100        50            100 5000        50    NA</span></span>
<span><span class="co">#&gt; 2 2019-11-03        sell      100        30              0    0         0    NA</span></span>
<span><span class="co">#&gt; 3 2019-11-04         buy      100        30            100 5000        50    NA</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Mr. Cryptoltruist.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
